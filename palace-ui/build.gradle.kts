fun getGitHash(): String {
    val proc = ProcessBuilder("git", "rev-parse", "--short", "HEAD")
        .redirectOutput(ProcessBuilder.Redirect.PIPE)
        .redirectError(ProcessBuilder.Redirect.PIPE)
        .start()

    proc.waitFor(10L, TimeUnit.SECONDS)
    return proc.inputStream.bufferedReader().readText().trim()
}

android {
    buildFeatures {
        buildConfig = true
    }

    defaultConfig {
        buildConfigField("String", "SIMPLIFIED_VERSION", "\"${rootProject.ext["VERSION_NAME"]}\"")
        buildConfigField("String", "SIMPLIFIED_GIT_COMMIT", "\"${getGitHash()}\"")
    }
}

dependencies {
    coreLibraryDesugaring(libs.android.desugaring)

    implementation(project(":palace-accessibility"))
    implementation(project(":palace-accounts-api"))
    implementation(project(":palace-accounts-database"))
    implementation(project(":palace-accounts-database-api"))
    implementation(project(":palace-accounts-json"))
    implementation(project(":palace-accounts-registry"))
    implementation(project(":palace-accounts-registry-api"))
    implementation(project(":palace-accounts-source-spi"))
    implementation(project(":palace-adobe-extensions"))
    implementation(project(":palace-analytics-api"))
    implementation(project(":palace-announcements"))
    implementation(project(":palace-bookmarks"))
    implementation(project(":palace-bookmarks-api"))
    implementation(project(":palace-books-api"))
    implementation(project(":palace-books-audio"))
    implementation(project(":palace-books-borrowing"))
    implementation(project(":palace-books-bundled-api"))
    implementation(project(":palace-books-controller"))
    implementation(project(":palace-books-controller-api"))
    implementation(project(":palace-books-covers"))
    implementation(project(":palace-books-database-api"))
    implementation(project(":palace-books-formats"))
    implementation(project(":palace-books-formats-api"))
    implementation(project(":palace-books-preview"))
    implementation(project(":palace-books-registry-api"))
    implementation(project(":palace-books-time-tracking"))
    implementation(project(":palace-boot-api"))
    implementation(project(":palace-buildconfig-api"))
    implementation(project(":palace-content-api"))
    implementation(project(":palace-crashlytics-api"))
    implementation(project(":palace-db"))
    implementation(project(":palace-db-api"))
    implementation(project(":palace-documents"))
    implementation(project(":palace-feeds-api"))
    implementation(project(":palace-files"))
    implementation(project(":palace-futures"))
    implementation(project(":palace-lcp"))
    implementation(project(":palace-links"))
    implementation(project(":palace-mdc"))
    implementation(project(":palace-notifications"))
    implementation(project(":palace-oauth"))
    implementation(project(":palace-opds-auth-document"))
    implementation(project(":palace-opds-auth-document-api"))
    implementation(project(":palace-opds-client"))
    implementation(project(":palace-opds-core"))
    implementation(project(":palace-opds2-irradia"))
    implementation(project(":palace-opds2-parser-api"))
    implementation(project(":palace-parser-api"))
    implementation(project(":palace-patron"))
    implementation(project(":palace-patron-api"))
    implementation(project(":palace-presentableerror-api"))
    implementation(project(":palace-profiles"))
    implementation(project(":palace-profiles-api"))
    implementation(project(":palace-profiles-controller-api"))
    implementation(project(":palace-reader-api"))
    implementation(project(":palace-reports"))
    implementation(project(":palace-services-api"))
    implementation(project(":palace-taskrecorder-api"))
    implementation(project(":palace-tenprint"))
    implementation(project(":palace-threads"))
    implementation(project(":palace-ui-bottomsheet"))
    implementation(project(":palace-ui-errorpage"))
    implementation(project(":palace-ui-images"))
    implementation(project(":palace-ui-screen"))
    implementation(project(":palace-viewer-api"))
    implementation(project(":palace-viewer-preview"))
    implementation(project(":palace-viewer-spi"))
    implementation(project(":palace-webview"))

    implementation(libs.androidx.activity)
    implementation(libs.androidx.activity.ktx)
    implementation(libs.androidx.annotation)
    implementation(libs.androidx.appcompat)
    implementation(libs.androidx.appcompat.resources)
    implementation(libs.androidx.cardview)
    implementation(libs.androidx.collection)
    implementation(libs.androidx.constraintlayout)
    implementation(libs.androidx.constraintlayout.core)
    implementation(libs.androidx.constraintlayout.solver)
    implementation(libs.androidx.coordinatorlayout)
    implementation(libs.androidx.core)
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.core.splashscreen)
    implementation(libs.androidx.customview)
    implementation(libs.androidx.customview.poolingcontainer)
    implementation(libs.androidx.drawerlayout)
    implementation(libs.androidx.emoji2)
    implementation(libs.androidx.emoji2.views)
    implementation(libs.androidx.emoji2.views.helper)
    implementation(libs.androidx.fragment)
    implementation(libs.androidx.fragment.ktx)
    implementation(libs.androidx.interpolator)
    implementation(libs.androidx.lifecycle.common)
    implementation(libs.androidx.lifecycle.extensions)
    implementation(libs.androidx.lifecycle.livedata)
    implementation(libs.androidx.lifecycle.livedata.core)
    implementation(libs.androidx.lifecycle.livedata.core.ktx)
    implementation(libs.androidx.lifecycle.livedata.ktx)
    implementation(libs.androidx.lifecycle.viewmodel)
    implementation(libs.androidx.lifecycle.viewmodel.savedstate)
    implementation(libs.androidx.paging.common)
    implementation(libs.androidx.paging.common.ktx)
    implementation(libs.androidx.paging.runtime)
    implementation(libs.androidx.paging.runtime.ktx)
    implementation(libs.androidx.preference)
    implementation(libs.androidx.recycler.view)
    implementation(libs.androidx.recyclerview)
    implementation(libs.androidx.savedstate)
    implementation(libs.androidx.swiperefreshlayout)
    implementation(libs.androidx.transition)
    implementation(libs.androidx.vectordrawable)
    implementation(libs.androidx.vectordrawable.animated)
    implementation(libs.androidx.viewpager2)
    implementation(libs.firebase.messaging)
    implementation(libs.google.failureaccess)
    implementation(libs.google.guava)
    implementation(libs.google.material)
    implementation(libs.io7m.jattribute.core)
    implementation(libs.io7m.jfunctional)
    implementation(libs.io7m.jmulticlose)
    implementation(libs.io7m.jnull)
    implementation(libs.io7m.junreachable)
    implementation(libs.irradia.mime.api)
    implementation(libs.irradia.opds2.api)
    implementation(libs.irradia.opds2.lexical)
    implementation(libs.irradia.opds2.librarysimplified)
    implementation(libs.irradia.opds2.parser.api)
    implementation(libs.irradia.opds2.parser.extension.spi)
    implementation(libs.irradia.opds2.parser.librarysimplified)
    implementation(libs.irradia.opds2.parser.vanilla)
    implementation(libs.jackson.core)
    implementation(libs.jackson.databind)
    implementation(libs.jcip.annotations)
    implementation(libs.joda.time)
    implementation(libs.kotlin.reflect)
    implementation(libs.kotlin.stdlib)
    implementation(libs.kotlinx.coroutines.android)
    implementation(libs.kotlinx.coroutines.core.jvm)
    implementation(libs.logback.android)
    implementation(libs.palace.audiobook.feedbooks)
    implementation(libs.palace.audiobook.time.tracking)
    implementation(libs.palace.audiobook.views)
    implementation(libs.palace.drm.core)
    implementation(libs.palace.http.api)
    implementation(libs.palace.http.bearer.token)
    implementation(libs.palace.http.vanilla)
    implementation(libs.palace.theme)
    implementation(libs.picasso)
    implementation(libs.play.services.base)
    implementation(libs.play.services.basement)
    implementation(libs.play.services.location)
    implementation(libs.play.services.tasks)
    implementation(libs.r2.lcp)
    implementation(libs.r2.shared)
    implementation(libs.rxandroid2)
    implementation(libs.rxjava2)
    implementation(libs.rxjava2.extensions)
    implementation(libs.slf4j)
    implementation(libs.transifex.sdk)
}
